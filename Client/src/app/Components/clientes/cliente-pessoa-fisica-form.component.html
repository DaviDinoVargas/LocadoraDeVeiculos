<div class="container mt-3">
  <h4 *ngIf="!editMode">Nova Pessoa Física</h4>
  <h4 *ngIf="editMode">Editar Pessoa Física</h4>

  <form [formGroup]="form" (ngSubmit)="salvar()">
    <!-- Nome -->
    <div class="mb-3">
      <label class="form-label">Nome Completo <span class="text-danger">*</span></label>
      <input class="form-control"
             formControlName="nome"
             placeholder="Digite o nome completo"/>
      <div *ngIf="form.controls['nome'].invalid && form.controls['nome'].touched"
           class="text-danger small">
        Nome é obrigatório.
      </div>
    </div>

    <!-- CPF -->
    <div class="mb-3">
      <label class="form-label">CPF <span class="text-danger">*</span></label>
      <input class="form-control"
             formControlName="cpf"
             placeholder="000.000.000-00"
             (input)="formatarCPFInput($event)"
             maxlength="14"/>
      <div *ngIf="form.controls['cpf'].invalid && form.controls['cpf'].touched"
           class="text-danger small">
        CPF inválido. Use o formato 000.000.000-00.
      </div>
      <small class="text-muted">Formato: 000.000.000-00</small>
    </div>

    <!-- RG -->
    <div class="mb-3">
      <label class="form-label">RG</label>
      <input class="form-control"
             formControlName="rg"
             placeholder="00.000.000-0"
             (input)="formatarRGInput($event)"
             maxlength="12"/>
      <small class="text-muted">Formato: 00.000.000-0</small>
    </div>

    <!-- CNH -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">CNH</label>
        <input class="form-control"
               formControlName="cnh"
               placeholder="Número da CNH"/>
      </div>
      <div class="col-md-6">
        <label class="form-label">Validade da CNH</label>
        <input type="date"
               class="form-control"
               formControlName="validadeCnh"/>
      </div>
    </div>

    <!-- Telefone -->
    <div class="mb-3">
      <label class="form-label">Telefone <span class="text-danger">*</span></label>
      <input class="form-control"
             formControlName="telefone"
             placeholder="(00) 00000-0000"
             (input)="formatarTelefoneInput($event)"
             maxlength="15"/>
      <div *ngIf="form.controls['telefone'].invalid && form.controls['telefone'].touched"
           class="text-danger small">
        Telefone é obrigatório.
      </div>
      <small class="text-muted">Formato: (00) 00000-0000</small>
    </div>

    <!-- Email -->
    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email"
             class="form-control"
             formControlName="email"
             placeholder="email@exemplo.com"/>
      <div *ngIf="form.controls['email'].invalid && form.controls['email'].touched"
           class="text-danger small">
        Email inválido.
      </div>
    </div>

    <!-- Endereço -->
    <div class="mb-3">
      <label class="form-label">Endereço</label>
      <textarea class="form-control"
                formControlName="endereco"
                rows="3"
                placeholder="Rua, número, bairro, cidade, estado"></textarea>
    </div>

    <!-- Cliente Pessoa Jurídica (opcional) -->
    <div class="mb-3">
      <label class="form-label">Vincular a Pessoa Jurídica (opcional)</label>
      <select class="form-select" formControlName="clientePessoaJuridicaId">
        <option [ngValue]="null">Nenhuma</option>
        <option *ngFor="let pj of pessoasJuridicas" [ngValue]="pj.id">{{ pj.nome }} ({{ formatarCNPJ(pj.cnpj) }})</option>
      </select>
    </div>

    <!-- Botões -->
    <div class="d-flex gap-2">
      <button class="btn btn-primary"
              type="submit"
              [disabled]="loading || form.invalid">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
        {{ editMode ? 'Salvar' : 'Criar' }}
      </button>
      <button class="btn btn-secondary"
              type="button"
              (click)="cancelar()"
              [disabled]="loading">
        Cancelar
      </button>
    </div>

    <!-- Erros de validação -->
    <div *ngIf="serverErrors.length > 0" class="alert alert-danger mt-3">
      <h6 class="alert-heading">Erros:</h6>
      <ul class="mb-0">
        <li *ngFor="let error of serverErrors">{{ error }}</li>
      </ul>
    </div>
  </form>
</div>
